("module-metadata" => ("icon" => "weather" "description" => "Open Weather Map") "setup" => ("location_id" => "3110642" "app_id" => "829583e5f0bad93f9c5a14f49321fb6e" "read_interval_hours" => 1) "rules" => ("rule1" => (if (< (k2c weather/main/temp) 0) "freeze warning") "rule2" => (if (> weather/main/humidity 95) "rain warning")) "read_weather" => (function () (set weather (get (http "GET" (concat "http://api.openweathermap.org/data/2.5/weather?id=" setup/location_id "&APPID=" setup/app_id) "output-format" => "json") "body")) (module-publish "@display") weather) "read_forecast" => (function () (set forecast (get (http "GET" (concat "http://api.openweathermap.org/data/2.5/forecast?id=" setup/location_id "&APPID=" setup/app_id "&cnt=3") "output-format" => "json") "body")) (module-publish "@display") forecast) "loop" => (while true (try (do (read_weather) (read_forecast) (for-each rules rule (eval rule))) (ex "*" => (set error (list ex (format-date (date)))))) (sleep (* setup/read_interval_hours 3600000))) "start" => (spawn (eval loop)) "dashboard" => ("widgets" => ("display_1" => ("type" => "display" "lines" => 6 "font-family" => "monospace" "get-value" => @display)) "layouts" => ("mobile-vertical" => ("dimensions" => (9 8) "widgets" => (("display_1" 0 2 9 4)))) "polling-interval" => 0) "@dashboards" => (function (headers data) (list "OWM Station" => dashboard)) "@display" => (function (headers body) (concat "Temperature: " (k2c weather/main/temp) "ยบ\n" "Humidity: " weather/main/humidity "%\n" "Pressure: " weather/main/pressure " hPa\n" (concat (hour forecast/list/0/dt) "h: " forecast/list/0/weather/0/description) "\n" (concat (hour forecast/list/1/dt) "h: " forecast/list/1/weather/0/description) "\n" (concat (hour forecast/list/2/dt) "h: " forecast/list/2/weather/0/description))) "k2c" => (function (kelvin) (/ (round (* 10 (- kelvin 273.15))) 10)) "hour" => (function (unix_time) (format-date (* unix_time 1000) "HH")) "weather" => ("coord" => ("lon" => 2.05 "lat" => 41.38) "weather" => (("id" => 801 "main" => "Clouds" "description" => "few clouds" "icon" => "02d")) "base" => "stations" "main" => ("temp" => 299.65 "pressure" => 1011 "humidity" => 44 "temp_min" => 299.15 "temp_max" => 300.15) "visibility" => 10000 "wind" => ("speed" => 3.6 "deg" => 70) "clouds" => ("all" => 20) "dt" => 1528628400 "sys" => ("type" => 1 "id" => 5470 "message" => 0.0035 "country" => "ES" "sunrise" => 1528604283 "sunset" => 1528658690) "id" => 3110642 "name" => "Sant Feliu de Llobregat" "cod" => 200) "forecast" => ("cod" => "200" "message" => 0.0037 "cnt" => 3 "list" => (("dt" => 1528632000 "main" => ("temp" => 303.12 "temp_min" => 299.179 "temp_max" => 303.12 "pressure" => 994.59 "sea_level" => 1024.53 "grnd_level" => 994.59 "humidity" => 53 "temp_kf" => 3.94) "weather" => (("id" => 803 "main" => "Clouds" "description" => "broken clouds" "icon" => "04d")) "clouds" => ("all" => 56) "wind" => ("speed" => 2.71 "deg" => 24.5031) "rain" => () "sys" => ("pod" => "d") "dt_txt" => "2018-06-10 12:00:00") ("dt" => 1528642800 "main" => ("temp" => 300.52 "temp_min" => 297.564 "temp_max" => 300.52 "pressure" => 993.7 "sea_level" => 1023.43 "grnd_level" => 993.7 "humidity" => 53 "temp_kf" => 2.96) "weather" => (("id" => 804 "main" => "Clouds" "description" => "overcast clouds" "icon" => "04d")) "clouds" => ("all" => 92) "wind" => ("speed" => 5.72 "deg" => 94.0011) "rain" => () "sys" => ("pod" => "d") "dt_txt" => "2018-06-10 15:00:00") ("dt" => 1528653600 "main" => ("temp" => 297.86 "temp_min" => 295.887 "temp_max" => 297.86 "pressure" => 993.58 "sea_level" => 1023.24 "grnd_level" => 993.58 "humidity" => 64 "temp_kf" => 1.97) "weather" => (("id" => 803 "main" => "Clouds" "description" => "broken clouds" "icon" => "04d")) "clouds" => ("all" => 64) "wind" => ("speed" => 4.26 "deg" => 98.0006) "rain" => () "sys" => ("pod" => "d") "dt_txt" => "2018-06-10 18:00:00")) "city" => ("id" => 3110642 "name" => "Sant Feliu de Llobregat" "coord" => ("lat" => 41.3833 "lon" => 2.05) "country" => "ES")))